set -e

use_asdf() {
  # Load if not loaded already
  if [[ ! -v ASDF_DIR ]]; then
    if [[ -s "$HOME/.asdf/asdf.sh" ]]; then
      . "$HOME/.asdf/asdf.sh"
      if [[ -s $HOME/.asdf/completions/asdf.bash ]]; then
        . "$HOME/.asdf/completions/asdf.bash"
      fi
    fi
  fi
}

asdf() {
  unset asdf
  asdf "$@"
}

use_sdk() {
  if [[ -s "${HOME}/.sdkman/bin/sdkman-init.sh" ]]; then
    # shellcheck disable=SC1090
    source "${HOME}/.sdkman/bin/sdkman-init.sh"
  fi
  if [[ $# -eq 2 ]]; then
    local candidate="$1"
    local candidate_version="$2"
    if ! SDK_OFFLINE_MODE=true sdk use "${candidate}" "${candidate_version}"; then
      sdk install "${candidate}" "${candidate_version}" < /dev/null
      SDK_OFFLINE_MODE=true sdk use "${candidate}" "${candidate_version}"
    fi
  else
    echo "ERROR: Wrong number of parameters, expected:" >&2
    echo "use sdk [CANDIDATE] [VERSION]" >&2
    return 1
  fi
}

use_pre-commit() {
  if ! [ -f "$(git rev-parse --show-toplevel)/.git/hooks/pre-commit" ]; then
    pre-commit install --install-hooks
  fi
}

use_pipx() {
  if ! has pipx; then
    if has python3; then
      python3 -m pip install --user pipx
      python3 -m pipx ensurepath
    else
      echo "Python 3 version 3.6 or higher required for PipX"
    fi
  fi
}

